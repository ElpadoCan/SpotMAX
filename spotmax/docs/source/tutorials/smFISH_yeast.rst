.. _Cell-ACDC: https://cell-acdc.readthedocs.io/en/latest/index.html

.. |load-folder| image:: ../images/folder-open.svg
    :width: 20

.. _smfish-yeast:

Single-molecule Fluorescence In Situ Hybridization (smFISH)
===========================================================

Single-molecule Fluorescence In Situ Hybridization (smFISH) is a technique used 
to visualize individual RNA molecules of specific gene.

In this tutorial we will count single mRNA molecules of the housekeeping gene MDN1 
in the model organism *S. cerevisiae*.

Besides detecting the spots we will also segment the nucleus as a reference channel 
from the ``DAPI`` staining. 

Preliminary steps
-----------------

The first step with every new dataset is to segment the objects. These typically 
are the single cells, but it can be any object where you want to detect spots. 

While you can detect spots in the entire image, it is highly recommended to 
identify region of interests (ROIs) and segment them.

The dataset provided with this tutorial already contains the segmentation files with 
the ROIs of the single cells, but if you need to segment ROIs we recommend using 
out other software called `Cell-ACDC`_.

Dataset
-------

To follow this tutorial, download the dataset from 
`here <https://hmgubox2.helmholtz-muenchen.de/index.php/s/nbsxXAsHr6DJCC9>`_.

This dataset was published in `this <https://doi.org/10.1101/2023.01.26.525696>`_ 
publication.

After unzipping the downloaded file, you will see the following folder structure::

    Position_2
    └── Images
        ├── MMY116_2c_ACT1_MDN1_10_s02_MDN1.tif
        ├── MMY116_2c_ACT1_MDN1_10_s02_metadata.csv
        ├── MMY116_2c_ACT1_MDN1_10_s02_ACT1.tif
        ├── MMY116_2c_ACT1_MDN1_10_s02_DAPI.tif
        ├── MMY116_2c_ACT1_MDN1_10_s02_phase_contr.tif
        ├── MMY116_2c_ACT1_MDN1_10_s02_segmInfo.csv
        ├── MMY116_2c_ACT1_MDN1_10_s02_manualBackground.npz
        ├── MMY116_2c_ACT1_MDN1_10_s02_segm.npz
        ├── MMY116_2c_ACT1_MDN1_10_s02_acdc_output.csv
        ├── MMY116_2c_ACT1_MDN1_10_s02_last_tracked_i.txt
        └── MMY116_2c_ACT1_MDN1_10_s02_custom_combine_metrics.ini

Some of these files are generated by `Cell-ACDC`_ and they will not be discussed here. 

What we can see is that we have 4 ``.tif`` files corresponding to 4 channels whose filename 
end with ``MDN1.tif``, ``ACT1.tif``, ``DAPI.tif``, and ``phase_contr.tif``. 

The ``ACT1`` channel will not be used in this tutorial. 

The ``phase_contr`` channel is the channel we used to segment the single cells with 
`Cell-ACDC`_. The resulting segmentation masks are saved in the file ending with 
``segm.npz``. 

The ``MDN1`` channel is the channel where we want to detect the spots. 

The ``DAPI`` channel is the staining of the nucleus and we can use it in spotMAX 
as the reference channel (more details below). 

.. note:: 

    spotMAX can take advantage of mother-bud (or sister cells) relationship. To 
    annotate the relationship use the `Cell-ACDC`_ software. These annotations 
    are saved in the file ending with ``acdc_output.csv``. 

Loading the dataset
-------------------

Now that we have our dataset with the segmentation file of the cells, we can proceed 
with detecting the spots. 

.. note:: 

    In this tutorial we assume that you are already familiar with the analysis 
    parameters. If not, please read about them here: :ref:`params-desc`.

The first step is to load the dataset into the GUI. To run the GUI see here: 
:ref:`how-to-run-gui`. 

Click on the |load-folder| ``Load folder`` button on the top-right of the GUI. 
Select the ``Position_2`` folder you downloaded and load the ``MDN1`` channel. 

When the dataset is loaded, you will see on the :ref:`analysis-parameters-tab` 
on the left that some of the parameters have already been filled out. 

Now let's see how we can determine the optimal parameters for this dataset.


Setting up the parameters
-------------------------

The parameters are grouped into separate sections so we will go one by one.

File paths and channels
^^^^^^^^^^^^^^^^^^^^^^^

Since we want to segment the nucleus as a reference channel from the ``DAPI`` 
channel, we write 'DAPI' in the ``Reference channel end name or path`` parameter. 

If we want to take advantage of the mother-bud (or sister cells) pairings we write 
'acdc_output' in the ``Table with lineage info end name or path`` parameter. 

We can then decide on a ``Run number`` (in this case we leave it at 1), and, 
optionally, we can append a text at the end of the output files by writing 
'tutorial' at in the ``Text to append at the end of the output files``. 

Finally, we select '.csv' for the ``File extension of the output tables``. 

METADATA
^^^^^^^^

Since some of the metadata is already saved in the file ending with ``metadata.csv`` 
some of the entries are already correct. 

We need to correct the ``Spots reporter emmission wavelength (nm)`` to 